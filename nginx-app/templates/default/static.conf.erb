server {
    listen 80 <%=@listen_opts%>;

    index <%=@default_router%> index.php;

    access_log <%=@access_log%>;

    location ~* (\.deploy_configuration) {
        deny all;
    }

    location = /index.html {
        add_header Pragma "no-cache";
        add_header Cache-Control "no-store, no-cache, must-revalidate, post-check=0, pre-check=0";
        expires -1;
    }

    location ~ (main-.*\.css|main\.min-.*\.js) {
        expires max;
    }

<% if @nginx_extra && !@nginx_extra.empty? -%>
    <%=@nginx_extra%>
<% end -%>

<% if !@domain_name.empty? -%>
    server_name <%=@domain_name%>;
<% end -%>

<%= render "partials/gzip.conf.erb", :cookbook => 'nginx-app', :variables => {
    :enabled => @gzip["enabled"],
    :config => @gzip["config"]
} %>

    location ~* \.(eot|ttf|woff)$ {
        add_header Access-Control-Allow-Origin *;
        expires max;
    }

    location / {
        try_files $uri $uri/ /index.html =404;
    }

    root <%= @doc_root%>;
}
